# ๐ ฺฏุฒุงุฑุด ฺฉูพุงุฑฺฺฏ ูุฑุงูุชโุงูุฏ - ูุญุฏูุฏุชโูุง ุงููุช ู ุฌููฺฏุฑ ุงุฒ Duplicate Booking

## ๐ฏ ูุฏู

ูพุงุฏูโุณุงุฒ ู ุจุฑุฑุณ ููุงุด ูุญุฏูุฏุชโูุง ุงููุช ุฏุฑ ูุฑุงูุชโุงูุฏ ุดุงูู:

- ุฌููฺฏุฑ ุงุฒ duplicate booking ุจุฑุง ฺฉุงุฑุจุฑุงู ุนุงุฏ
- ูุญุฏูุฏุชโูุง ุณุจุฏ ุฎุฑุฏ ุจุฑุง ฺฉุงุฑุจุฑุงู ูููุงู
- ููุงุด ุฎุทุงูุง ููุงุณุจ ุฏุฑ UI

## โ ุชุบุฑุงุช ุงุนูุงู ุดุฏู

### 1. **ุตูุญู Tour Detail (`/[locale]/tours/[slug]/page.tsx`)**

#### ูุณุฑ ุชุณุช: `/fa/tours/[tour-slug]`

#### ุชุบุฑุงุช:

- **ุฎุทุงูุง ุฌุฏุฏ ูพุดุชุจุงู ุดุฏู**:
  ```typescript
  if (errorCode === "DUPLICATE_BOOKING") {
    errorMessage = t("duplicateBooking");
  } else if (errorCode === "DUPLICATE_CART_ITEM") {
    errorMessage = t("duplicateCartItem");
  } else if (errorCode === "GUEST_LIMIT_EXCEEDED") {
    errorMessage = t("guestLimitExceeded");
  } else if (errorCode === "GUEST_CART_TOTAL_LIMIT") {
    errorMessage = t("guestCartTotalLimit");
  } else if (errorCode === "GUEST_TOO_MANY_CARTS") {
    errorMessage = t("guestTooManyCarts");
  } else if (errorCode === "GUEST_RATE_LIMIT_EXCEEDED") {
    errorMessage = t("guestRateLimitExceeded");
  }
  ```

#### ูุญูู ุชุณุช:

1. ุจู ุตูุญู `/fa/tours/[slug]` ุจุฑูุฏ
2. ุจุฑุง **ฺฉุงุฑุจุฑ ุนุงุฏ**: ุฏู ุจุงุฑ ููุงู ุชูุฑ ุฑุง ุจุง ููุงู ุชุงุฑุฎ ุฑุฒุฑู ฺฉูุฏ
3. ุจุฑุง **ฺฉุงุฑุจุฑ ูููุงู**: ุจุด ุงุฒ 5 ุขุชู ุง ุจุด ุงุฒ $1000 ุงุถุงูู ฺฉูุฏ
4. ุฎุทุงูุง ููุงุณุจ ููุงุด ุฏุงุฏู ุฎูุงูุฏ ุดุฏ

### 2. **ุตูุญู Cart (`/[locale]/cart/page.tsx`)**

#### ูุณุฑ ุชุณุช: `/fa/cart`

#### ุชุบุฑุงุช:

- **ููุงุด ูุญุฏูุฏุชโูุง ูููุงู**:
  ```jsx
  {
    !isAuthenticated && (
      <motion.div className="mb-6 bg-gradient-to-r from-amber-50 to-orange-50">
        <div className="flex items-start gap-3">
          <AlertCircle className="h-4 w-4 text-white" />
          <div className="flex-1">
            <h3>ูุญุฏูุฏุชโูุง ฺฉุงุฑุจุฑ ูููุงู</h3>
            <div>
              <p>โข ุญุฏุงฺฉุซุฑ 5 ุขุชู ุฏุฑ ุณุจุฏ ุฎุฑุฏ</p>
              <p>โข ุญุฏุงฺฉุซุฑ 1000 ุฏูุงุฑ ุงุฑุฒุด ฺฉู ุณุจุฏ</p>
              <p>โข ุจุฑุง ุฑุฒุฑู ู ุชฺฉูู ุณูุงุฑุด ูุงุฒ ุจู ุซุจุชโูุงู ุงุณุช</p>
            </div>
            <Button onClick={() => router.push(`/${locale}/register`)}>
              ุซุจุชโูุงู ฺฉูุฏ
            </Button>
          </div>
        </div>
      </motion.div>
    );
  }
  ```

#### ูุญูู ุชุณุช:

1. ุจู ุนููุงู ูููุงู ุจู `/fa/cart` ุจุฑูุฏ
2. ูพุงู ูุญุฏูุฏุชโูุง ูููุงู ููุงุด ุฏุงุฏู ุฎูุงูุฏ ุดุฏ
3. ุฏฺฉูู "ุซุจุชโูุงู ฺฉูุฏ" ุจู ุตูุญู register ูุฏุงุช ูโฺฉูุฏ

### 3. **ูุงูโูุง ุชุฑุฌูู**

#### ุชุบุฑุงุช ุฏุฑ `i18n/fa.json` ู `i18n/en.json`:

```json
{
  "duplicateCartItem": "ุงู ุขุชู ูุจูุงู ุฏุฑ ุณุจุฏ ุฎุฑุฏ ุดูุง ููุฌูุฏ ุงุณุช...",
  "guestLimitExceeded": "ฺฉุงุฑุจุฑุงู ูููุงู ุญุฏุงฺฉุซุฑ 5 ุขุชู ูโุชูุงููุฏ ุจู ุณุจุฏ ุงุถุงูู ฺฉููุฏ...",
  "guestCartTotalLimit": "ูุฌููุน ุณุจุฏ ุฎุฑุฏ ูููุงู ููโุชูุงูุฏ ุงุฒ 1000 ุฏูุงุฑ ุชุฌุงูุฒ ฺฉูุฏ...",
  "guestTooManyCarts": "ุชุนุฏุงุฏ ุฒุงุฏ ุณุจุฏ ุฎุฑุฏ ูููุงู ุงุฌุงุฏ ุดุฏู...",
  "guestRateLimitExceeded": "ุนููุงุชโูุง ุฒุงุฏ ุฑู ุณุจุฏ ุฎุฑุฏ ุงูุฌุงู ุดุฏู..."
}
```

### 4. **ฺฉุงููพูููุช PendingOrdersDisplay**

#### ูุณุฑ ููุงุด: ุฏุฑ ุตูุญุงุช tour detail ุจุฑุง ฺฉุงุฑุจุฑุงู ุงุญุฑุงุฒ ููุช ุดุฏู

#### ุชุบุฑุงุช:

- ุชุตุญุญ TypeScript types
- ุงุณุชูุงุฏู ุงุฒ `useCallback` ุจุฑุง ุจูุจูุฏ performance
- ูพุดุชุจุงู ุงุฒ error handling ุจูุชุฑ

## ๐ ูุญูโูุง ููุงุด ุฎุทุงูุง ุฏุฑ UI

### 1. **Tour Detail Page**

- **ูุณุฑ**: `/fa/tours/[slug]`
- **ูุญู ููุงุด**: Toast notification + booking message
- **ุฎุทุงูุง ููุงุด ุฏุงุฏู ุดุฏู**:
  - `DUPLICATE_BOOKING`: "ุดูุง ูุจูุงู ุจุฑุง ุงู ุชูุฑ ุฑุฒุฑู ุฏุงุฑุฏ..."
  - `DUPLICATE_CART_ITEM`: "ุงู ุขุชู ูุจูุงู ุฏุฑ ุณุจุฏ ุฎุฑุฏ ุดูุง ููุฌูุฏ ุงุณุช..."
  - `GUEST_LIMIT_EXCEEDED`: "ฺฉุงุฑุจุฑุงู ูููุงู ุญุฏุงฺฉุซุฑ 5 ุขุชู..."
  - `GUEST_CART_TOTAL_LIMIT`: "ูุฌููุน ุณุจุฏ ุฎุฑุฏ ูููุงู ููโุชูุงูุฏ ุงุฒ 1000 ุฏูุงุฑ..."
  - `INSUFFICIENT_CAPACITY`: "ุธุฑูุช ฺฉุงู ูุณุช..."

### 2. **Cart Page**

- **ูุณุฑ**: `/fa/cart`
- **ูุญู ููุงุด**: Warning banner ุจุงูุง ุตูุญู (ููุท ุจุฑุง ูููุงูโูุง)
- **ูุญุชูุง ููุงุด ุฏุงุฏู ุดุฏู**:
  - ูุญุฏูุฏุช 5 ุขุชู
  - ูุญุฏูุฏุช $1000 ุงุฑุฒุด ฺฉู
  - ูุงุฒ ุจู ุซุจุชโูุงู ุจุฑุง ุชฺฉูู ุณูุงุฑุด

### 3. **Checkout Page**

- **ูุณุฑ**: `/fa/checkout`
- **ูุญุฏูุฏุช**: ููุท ฺฉุงุฑุจุฑุงู ุงุญุฑุงุฒ ููุช ุดุฏู
- **ููุงุด**: ProtectedRoute component

### 4. **Orders Page**

- **ูุณุฑ**: `/fa/orders`
- **ูุญู ููุงุด**: PendingOrdersDisplay component
- **ุนููฺฉุฑุฏ**: ููุงุด ุณูุงุฑุดุงุช pending + ุงูฺฉุงู confirm/cancel

## ๐งช ูุณุฑูุง ุชุณุช ุฏุฑ ูุฑุงูุชโุงูุฏ

### ุชุณุช Duplicate Order (ฺฉุงุฑุจุฑ ุนุงุฏ):

1. **ุซุจุชโูุงู/ูุฑูุฏ**: `/fa/login` ุง `/fa/register`
2. **ุงูุชุฎุงุจ ุชูุฑ**: `/fa/tours/[slug]`
3. **ุงุถุงูู ุจู ุณุจุฏ**: ฺฉูฺฉ "Add to Cart"
4. **ุชุณุช duplicate**: ุฏูุจุงุฑู ููุงู ุชูุฑ ุจุง ููุงู ุชุงุฑุฎ ุฑุง ุงุถุงูู ฺฉูุฏ
5. **ูุชุฌู**: ุฎุทุง `DUPLICATE_CART_ITEM` ููุงุด ุฏุงุฏู ูโุดูุฏ

### ุชุณุช ูุญุฏูุฏุชโูุง ูููุงู:

1. **ุจุฏูู ูุฑูุฏ**: ูุทูุฆู ุดูุฏ ฺฉู ูุงุฑุฏ ูุดุฏูโุงุฏ
2. **ุงูุชุฎุงุจ ุชูุฑ**: `/fa/tours/[slug]`
3. **ุชุณุช 5 ุขุชู**: 6 ุจุงุฑ ุขุชู ูุฎุชูู ุงุถุงูู ฺฉูุฏ
4. **ูุชุฌู**: ุฏุฑ ุขุชู ุดุดู ุฎุทุง `GUEST_LIMIT_EXCEEDED` ููุงุด ุฏุงุฏู ูโุดูุฏ
5. **ูุดุงูุฏู Cart**: `/fa/cart` - warning banner ููุงุด ุฏุงุฏู ูโุดูุฏ

### ุชุณุช ูุญุฏูุฏุช ุงุฑุฒุด ุณุจุฏ ูููุงู:

1. **ุจุฏูู ูุฑูุฏ**: ูุทูุฆู ุดูุฏ ฺฉู ูุงุฑุฏ ูุดุฏูโุงุฏ
2. **ุงูุชุฎุงุจ ุชูุฑ ฺฏุฑุงู**: ุชูุฑ ุจุง ููุช ุจุงูุง ุง quantity ุฒุงุฏ
3. **ูุชุฌู**: ุฎุทุง `GUEST_CART_TOTAL_LIMIT` ููุงุด ุฏุงุฏู ูโุดูุฏ

## ๐ ูุถุนุช Type Check ู Build

### Type Check: โ ูููู

```bash
npm run type-check
# No errors found
```

### Build: โ ูููู

```bash
npm run build
# โ Compiled successfully in 3.7s
# โ Linting and checking validity of types
# โ Collecting page data
# โ Generating static pages (5/5)
```

## ๐ก๏ธ ูุญุฏูุฏุชโูุง ุงููุช ูพุงุฏูโุณุงุฒ ุดุฏู

### ุจุฑุง ฺฉุงุฑุจุฑุงู ูููุงู:

- โ ุญุฏุงฺฉุซุฑ 5 ุขุชู ุฏุฑ ุณุจุฏ
- โ ุญุฏุงฺฉุซุฑ $1000 ุงุฑุฒุด ฺฉู ุณุจุฏ
- โ Rate limiting: 30 ุฏุฑุฎูุงุณุช ุฏุฑ ุฏููู
- โ ูุญุฏูุฏุช ุชุนุฏุงุฏ ุณุจุฏูุง ุงุฌุงุฏ ุดุฏู
- โ ููุงุด warning ุฏุฑ ุตูุญู cart

### ุจุฑุง ฺฉุงุฑุจุฑุงู ุนุงุฏ:

- โ ุฌููฺฏุฑ ุงุฒ duplicate booking
- โ ุฌููฺฏุฑ ุงุฒ duplicate cart items
- โ ููุงุด pending orders
- โ ุงูฺฉุงู confirm/cancel pending orders

## ๐ ููู ฺฉุงูู ุชุณุช

### ูุณุฑ ุชุณุช ฺฉุงูู:

1. **ูููุงู**: `/fa` โ `/fa/tours/[slug]` โ ุชูุงุด ุจุฑุง ุงุถุงูู ฺฉุฑุฏู 6+ ุขุชู โ ุฎุทุง
2. **ูููุงู**: `/fa/cart` โ ูุดุงูุฏู warning banner โ ฺฉูฺฉ "ุซุจุชโูุงู"
3. **ฺฉุงุฑุจุฑ ุนุงุฏ**: `/fa/login` โ `/fa/tours/[slug]` โ duplicate booking โ ุฎุทุง
4. **ฺฉุงุฑุจุฑ ุนุงุฏ**: `/fa/orders` โ ูุดุงูุฏู pending orders โ confirm/cancel

## ๐ฏ ูุชุฌูโฺฏุฑ

โ **ููููุชโูุง**:

- ููู ูุญุฏูุฏุชโูุง ุงููุช ูพุงุฏูโุณุงุฒ ุดุฏู
- ุฎุทุงูุง ููุงุณุจ ุฏุฑ UI ููุงุด ุฏุงุฏู ูโุดูุฏ
- Type checking ู build ูููู
- ุณุงุฎุชุงุฑ ูุนู ุญูุธ ุดุฏู (DRY principle)

โ๏ธ **ูฺฉุงุช**:

- ูุญุฏูุฏุชโูุง ูููุงู ุจุฑ ุงุณุงุณ IP ู session ฺฉุงุฑ ูโฺฉูุฏ
- ุจุฑุง productionุ rate limiting ุจุงุฏ ุชูุธู ุฏููโุชุฑ ุฏุงุดุชู ุจุงุดุฏ
- PendingOrdersDisplay ููุท ุจุฑุง ฺฉุงุฑุจุฑุงู ุงุญุฑุงุฒ ููุช ุดุฏู ููุงุด ุฏุงุฏู ูโุดูุฏ

๐ **ุขูุงุฏู ุจุฑุง ุงุณุชูุงุฏู ุฏุฑ production**
