# نمودار سیستم‌های تصویر در پروژه

## وضعیت فعلی (Current State)

```
┌─────────────────────────────────────────────────────────────────┐
│                         BACKEND (Django)                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────┐      ┌──────────────┐      ┌──────────────┐  │
│  │ HeroSlider   │      │ Tour/Event   │      │ImageOptimiz. │  │
│  │              │      │              │      │              │  │
│  │ desktop_img  │      │ image        │      │ original_img │  │
│  │ tablet_img   │      │              │      │ desktop_ver  │  │
│  │ mobile_img   │      │              │      │ tablet_ver   │  │
│  │              │      │              │      │ mobile_ver   │  │
│  └──────┬───────┘      └──────┬───────┘      └──────────────┘  │
│         │                     │                      ❌          │
│         │ API                 │ API              (استفاده نمیشود)│
│         ▼                     ▼                                 │
└─────────────────────────────────────────────────────────────────┘
          │                     │
          │                     │
          ▼                     ▼
┌─────────────────────────────────────────────────────────────────┐
│                      FRONTEND (Next.js 15)                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │              OptimizedImage Component                     │  │
│  │  (Wrapper for Next.js Image + Fallback handling)         │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌──────────────┐                    ┌──────────────┐          │
│  │ HeroSection  │                    │  TourCard    │          │
│  │              │                    │              │          │
│  │ <Optimized   │                    │ <Optimized   │          │
│  │  Image       │                    │  Image       │          │
│  │  src={slide  │                    │  src={tour   │          │
│  │  .desktop}   │                    │  .image_url} │          │
│  │ />           │                    │ />           │          │
│  └──────────────┘                    └──────────────┘          │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘

✅ کار میکند          ✅ کار میکند          ❌ استفاده نمیشود
```

---

## وضعیت پیشنهادی (Proposed State)

```
┌─────────────────────────────────────────────────────────────────┐
│                         BACKEND (Django)                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────┐      ┌──────────────┐                         │
│  │ HeroSlider   │      │ Tour/Event   │                         │
│  │              │      │              │                         │
│  │ desktop_img  │      │ image ───────┼──┐                      │
│  │ tablet_img   │      │              │  │                      │
│  │ mobile_img   │      │ optimizations│◄─┘ GenericRelation     │
│  │              │      │              │                         │
│  └──────┬───────┘      └──────┬───────┘                         │
│         │                     │                                 │
│         │                     │                                 │
│         │                     ▼                                 │
│         │              ┌──────────────┐                         │
│         │              │ImageOptimiz. │                         │
│         │              │              │                         │
│         │              │ content_type │ ◄── Generic Relation    │
│         │              │ object_id    │                         │
│         │              │              │                         │
│         │              │ original_img │                         │
│         │              │ desktop_ver  │ ◄── Auto-generated      │
│         │              │ tablet_ver   │     by Signal           │
│         │              │ mobile_ver   │                         │
│         │              │ thumbnail    │                         │
│         │              └──────┬───────┘                         │
│         │                     │                                 │
│         │ API                 │ API (با optimized_images)       │
│         ▼                     ▼                                 │
└─────────────────────────────────────────────────────────────────┘
          │                     │
          │                     │
          ▼                     ▼
┌─────────────────────────────────────────────────────────────────┐
│                      FRONTEND (Next.js 15)                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │         Enhanced OptimizedImage Component                 │  │
│  │  (با پشتیبانی از srcSet و responsive images)             │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                  │
│  ┌──────────────┐                    ┌──────────────┐          │
│  │ HeroSection  │                    │  TourCard    │          │
│  │              │                    │              │          │
│  │ <Optimized   │                    │ <Optimized   │          │
│  │  Image       │                    │  Image       │          │
│  │  src={slide  │                    │  src={tour   │          │
│  │  .desktop}   │                    │  .optimized  │          │
│  │ />           │                    │  .desktop}   │          │
│  │              │                    │  srcSet={...}│          │
│  └──────────────┘                    │ />           │          │
│                                      └──────────────┘          │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘

✅ کار میکند          ✅ بهینه شده          ✅ یکپارچه
```


---

## جریان داده (Data Flow)

### فعلی (Current)

```
┌─────────────┐
│   Admin     │
│  Upload     │
│   Image     │
└──────┬──────┘
       │
       ▼
┌─────────────────────┐
│  Tour.image         │
│  "istanbul.jpg"     │
│  (5MB, 4000x3000)   │
└──────┬──────────────┘
       │
       │ API Call
       ▼
┌─────────────────────┐
│  API Response       │
│  {                  │
│    image_url: "..." │
│  }                  │
└──────┬──────────────┘
       │
       ▼
┌─────────────────────┐
│  Frontend           │
│  <OptimizedImage    │
│   src={image_url}   │
│  />                 │
└──────┬──────────────┘
       │
       ▼
┌─────────────────────┐
│  User Download      │
│  5MB for all! 😱    │
└─────────────────────┘
```

### پیشنهادی (Proposed)

```
┌─────────────┐
│   Admin     │
│  Upload     │
│   Image     │
└──────┬──────┘
       │
       ▼
┌─────────────────────┐
│  Tour.image         │
│  "istanbul.jpg"     │
│  (5MB, 4000x3000)   │
└──────┬──────────────┘
       │
       │ Signal Triggered
       ▼
┌─────────────────────────────────────┐
│  ImageOptimizationService           │
│  ┌─────────────────────────────┐   │
│  │ Pillow Processing           │   │
│  │ - Resize to 1920x1080 (85%) │   │
│  │ - Resize to 1024x768 (80%)  │   │
│  │ - Resize to 768x1024 (75%)  │   │
│  │ - Resize to 300x200 (70%)   │   │
│  └─────────────────────────────┘   │
└──────┬──────────────────────────────┘
       │
       ▼
┌─────────────────────────────────────┐
│  ImageOptimization                  │
│  - desktop: 500KB                   │
│  - tablet: 200KB                    │
│  - mobile: 150KB                    │
│  - thumbnail: 50KB                  │
└──────┬──────────────────────────────┘
       │
       │ API Call
       ▼
┌─────────────────────────────────────┐
│  API Response                       │
│  {                                  │
│    image_url: "...",                │
│    optimized_images: {              │
│      desktop: "...",                │
│      tablet: "...",                 │
│      mobile: "...",                 │
│      thumbnail: "..."               │
│    }                                │
│  }                                  │
└──────┬──────────────────────────────┘
       │
       ▼
┌─────────────────────────────────────┐
│  Frontend                           │
│  <OptimizedImage                    │
│   src={optimized.desktop}           │
│   srcSet={`                         │
│     ${optimized.mobile} 768w,       │
│     ${optimized.tablet} 1024w,      │
│     ${optimized.desktop} 1920w      │
│   `}                                │
│  />                                 │
└──────┬──────────────────────────────┘
       │
       ▼
┌─────────────────────────────────────┐
│  User Download                      │
│  Mobile: 150KB (97% کاهش!) 🎉      │
│  Desktop: 500KB (90% کاهش!) 🎉     │
└─────────────────────────────────────┘
```

---

## مقایسه سیستم‌ها

```
┌────────────────────┬──────────────┬──────────────┬──────────────┐
│     Feature        │ HeroSlider   │ Tour/Event   │ImageOptimiz. │
├────────────────────┼──────────────┼──────────────┼──────────────┤
│ Responsive Images  │ ✅ Manual    │ ❌ Single    │ ✅ Auto      │
│                    │ (3 fields)   │              │ (4 sizes)    │
├────────────────────┼──────────────┼──────────────┼──────────────┤
│ Connected to       │ -            │ ✅ Direct    │ ❌ None      │
│ Product            │              │              │              │
├────────────────────┼──────────────┼──────────────┼──────────────┤
│ Auto Optimization  │ ❌ Manual    │ ❌ None      │ ❌ Not       │
│                    │              │              │ Implemented  │
├────────────────────┼──────────────┼──────────────┼──────────────┤
│ Used in Frontend   │ ✅ Yes       │ ✅ Yes       │ ❌ No        │
├────────────────────┼──────────────┼──────────────┼──────────────┤
│ Admin Interface    │ ✅ Complete  │ ✅ Complete  │ ✅ Basic     │
├────────────────────┼──────────────┼──────────────┼──────────────┤
│ API Endpoint       │ ✅ Yes       │ ✅ Yes       │ ✅ Yes       │
│                    │              │              │ (unused)     │
└────────────────────┴──────────────┴──────────────┴──────────────┘
```

---

## تاثیر بر Performance

### قبل از بهینه‌سازی

```
Mobile User (4G):
┌─────────────────────────────────────┐
│ Download: 5MB image                 │
│ Time: ~10 seconds                   │
│ Data Usage: 5MB                     │
│ User Experience: 😢 Slow            │
└─────────────────────────────────────┘

Desktop User (WiFi):
┌─────────────────────────────────────┐
│ Download: 5MB image                 │
│ Time: ~2 seconds                    │
│ Data Usage: 5MB                     │
│ User Experience: 😐 OK              │
└─────────────────────────────────────┘
```

### بعد از بهینه‌سازی

```
Mobile User (4G):
┌─────────────────────────────────────┐
│ Download: 150KB image               │
│ Time: ~0.3 seconds                  │
│ Data Usage: 150KB                   │
│ User Experience: 😊 Fast            │
│ Improvement: 97% faster! 🎉         │
└─────────────────────────────────────┘

Desktop User (WiFi):
┌─────────────────────────────────────┐
│ Download: 500KB image               │
│ Time: ~0.5 seconds                  │
│ Data Usage: 500KB                   │
│ User Experience: 😃 Very Fast       │
│ Improvement: 90% faster! 🎉         │
└─────────────────────────────────────┘
```

---

## Storage Impact

```
Before Optimization:
┌─────────────────────────────────────┐
│ 100 Products × 5MB = 500MB          │
└─────────────────────────────────────┘

After Optimization:
┌─────────────────────────────────────┐
│ Original: 100 × 5MB = 500MB         │
│ Desktop:  100 × 500KB = 50MB        │
│ Tablet:   100 × 200KB = 20MB        │
│ Mobile:   100 × 150KB = 15MB        │
│ Thumb:    100 × 50KB = 5MB          │
│ ─────────────────────────────────   │
│ Total: 590MB (18% increase)         │
│                                     │
│ Trade-off:                          │
│ +90MB storage = -90% bandwidth! 🎉  │
└─────────────────────────────────────┘
```

