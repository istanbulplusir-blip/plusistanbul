# ุชุญูู ุณุณุชู ูุงฺฉุชูุฑ ู ุฑุณุฏ

## ูุถุนุช ูุนู - ุฏู ุณุณุชู ุฌุฏุงฺฏุงูู

### 1๏ธโฃ ุณุณุชู ุงูู: `pdf_service.py` (PDFReceiptGenerator)
**ูฺฉุงู:** `backend/orders/pdf_service.py`

**ูฺฺฏโูุง:**
- โ ูพุดุชุจุงู ฺฉุงูู ุงุฒ ูููุช ูุงุฑุณ (Vazirmatn, Sahel)
- โ ูพุดุชุจุงู ุงุฒ RTL (ุฑุงุณุช ุจู ฺูพ)
- โ ุงุณุชูุงุฏู ุงุฒ `arabic_reshaper` ู `bidi`
- โ ุทุฑุงุญ ุญุฑููโุง ุจุง ุฑูฺฏโุจูุฏ ู ุงุณุชุงู ุจูุชุฑ
- โ ููฺฏู ู ูุฏุฑ ุฒุจุง
- โ ุฏู ูุชุฏ: `generate_receipt()` ู `generate_invoice()`
- โ ุฌุฏุงุณุงุฒ ูุงุถุญ ุจู Receipt (ุฑุณุฏ) ู Invoice (ูุงฺฉุชูุฑ)

**ูุชุฏูุง:**
- `generate_receipt()` - ุฑุณุฏ ุณุงุฏู
- `generate_invoice()` - ูุงฺฉุชูุฑ ฺฉุงูู ุจุง ุงุทูุงุนุงุช ุตูุฑุชุญุณุงุจ

**ุงุณุชูุงุฏู:**
- ุฏุฑ ุตูุญู ูุณุช ุณูุงุฑุดุงุช: `/orders/` โ ุฏฺฉูู Download โ `/invoice/`

---

### 2๏ธโฃ ุณุณุชู ุฏูู: `receipt_service.py` (ReceiptService)
**ูฺฉุงู:** `backend/orders/receipt_service.py`

**ูฺฺฏโูุง:**
- โ ุจุฏูู ูพุดุชุจุงู ูุงุฑุณ
- โ ููุท ุงูฺฏูุณ (Helvetica font)
- โ ุทุฑุงุญ ุณุงุฏูโุชุฑ
- โ ุณุจฺฉโุชุฑ ู ุณุฑุนโุชุฑ
- โ ูุชุฏ HTML ุจุฑุง ููุงุด ูุจ

**ูุชุฏูุง:**
- `generate_receipt_pdf()` - ุฑุณุฏ PDF ุณุงุฏู
- `generate_receipt_html()` - ุฑุณุฏ HTML

**ุงุณุชูุงุฏู:**
- ุฏุฑ ุตูุญู ุฌุฒุฆุงุช ุณูุงุฑุด: `/orders/ORDA3699B6E/` โ ุฏฺฉูู Download โ `/receipt/`

---

## ููุงุณู ุฏู ุณุณุชู

| ูฺฺฏ | pdf_service.py | receipt_service.py |
|-------|----------------|-------------------|
| ูพุดุชุจุงู ูุงุฑุณ | โ ฺฉุงูู | โ ูุฏุงุฑุฏ |
| RTL Support | โ ุฏุงุฑุฏ | โ ูุฏุงุฑุฏ |
| ุทุฑุงุญ | โญโญโญโญโญ ุญุฑููโุง | โญโญโญ ุณุงุฏู |
| ููฺฏู | โ ุฏุงุฑุฏ | โ ูุฏุงุฑุฏ |
| ุฑูฺฏโุจูุฏ | โ ุฒุจุง | โญ ูุนููู |
| ุณุฑุนุช | โญโญโญ ูุชูุณุท | โญโญโญโญ ุณุฑุน |
| ุญุฌู ฺฉุฏ | ุจุฒุฑฺฏโุชุฑ | ฺฉูฺฺฉโุชุฑ |
| ูฺฏูุฏุงุฑ | ูพฺุฏูโุชุฑ | ุณุงุฏูโุชุฑ |

---

## ุชูุตู: ฺฉูพุงุฑฺูโุณุงุฒ

### โ ุฑุงู ุญู ูพุดููุงุฏ: ุงุณุชูุงุฏู ุงุฒ `pdf_service.py` ุจุฑุง ููู

**ุฏูุงู:**
1. ูพุดุชุจุงู ฺฉุงูู ุงุฒ ูุงุฑุณ (ุถุฑูุฑ ุจุฑุง ูพุฑูฺู ุงุฑุงู)
2. ุทุฑุงุญ ุญุฑููโุงโุชุฑ ู ุฒุจุงุชุฑ
3. ูุงุจูุช ุชููุฏ ูู Receipt ู ูู Invoice
4. ุณุงุฒฺฏุงุฑ ุจูุชุฑ ุจุง ูุงุฒูุง ฺฉุณุจโูฺฉุงุฑ

**ูุฑุงุญู ฺฉูพุงุฑฺูโุณุงุฒ:**

### ูุฑุญูู 1: ุญุฐู `receipt_service.py`
- ุงู ูุงู ุฏฺฏุฑ ูุงุฒ ูุณุช

### ูุฑุญูู 2: ุขูพุฏุช `views.py`
```python
def _get_receipt(self, order, request):
    """Generate and return order receipt PDF."""
    try:
        from .pdf_service import pdf_generator
        pdf_data = pdf_generator.generate_receipt(order)
        
        from django.http import HttpResponse
        response = HttpResponse(pdf_data, content_type='application/pdf')
        response['Content-Disposition'] = f'attachment; filename="receipt_{order.order_number}.pdf"'
        return response
    except Exception as e:
        return Response(
            {'error': f'Failed to generate receipt: {str(e)}'},
            status=status.HTTP_500_INTERNAL_SERVER_ERROR
        )
```

### ูุฑุญูู 3: ฺฉุณุงูโุณุงุฒ ูุฑุงูุชโุงูุฏ
- ูุฑ ุฏู ุตูุญู ุงุฒ ููุงู endpoint ุงุณุชูุงุฏู ฺฉููุฏ
- ุง `/invoice/` ุจุฑุง ูุงฺฉุชูุฑ ฺฉุงูู
- ุง `/receipt/` ุจุฑุง ุฑุณุฏ ุณุงุฏู

---

## ุชูุงูุช Receipt vs Invoice

### Receipt (ุฑุณุฏ) ๐งพ
- ุณูุฏ ูพุฑุฏุงุฎุช
- ุณุงุฏูโุชุฑ
- ุจุนุฏ ุงุฒ ูพุฑุฏุงุฎุช ุตุงุฏุฑ ูโุดูุฏ
- ุชุฃุฏ ุฏุฑุงูุช ูพูู

### Invoice (ูุงฺฉุชูุฑ) ๐
- ุณูุฏ ูุงูุงุช
- ฺฉุงููโุชุฑ
- ุดุงูู ุงุทูุงุนุงุช ุตูุฑุชุญุณุงุจ
- ูุจู ุง ุจุนุฏ ุงุฒ ูพุฑุฏุงุฎุช
- ุดุงูู ุฌุฒุฆุงุช ูุงูุงุช

---

## ูพุดููุงุฏ ููุง

### ฺฏุฒูู A: ุงุณุชูุงุฏู ุงุฒ Invoice ุจุฑุง ููู (ุชูุตู ูโุดูุฏ)
```python
# ุฏุฑ ูุฑ ุฏู endpoint ุงุฒ generate_invoice ุงุณุชูุงุฏู ฺฉูู
pdf_data = pdf_generator.generate_invoice(order)
```

**ูุฒุงุง:**
- ฺฉ ุณุณุชู ูุงุญุฏ
- ุงุทูุงุนุงุช ฺฉุงููโุชุฑ
- ููุงุณุจ ุจุฑุง ุงููุฑ ูุงูุงุช
- ุธุงูุฑ ุญุฑููโุงโุชุฑ

### ฺฏุฒูู B: ูฺฏูโุฏุงุดุชู ูุฑ ุฏู
```python
# Receipt: ุฑุณุฏ ุณุงุฏู ุจุฑุง ูุดุชุฑ
pdf_data = pdf_generator.generate_receipt(order)

# Invoice: ูุงฺฉุชูุฑ ฺฉุงูู ุจุฑุง ุญุณุงุจุฏุงุฑ
pdf_data = pdf_generator.generate_invoice(order)
```

**ูุฒุงุง:**
- ุงูุนุทุงู ุจุดุชุฑ
- ูุดุชุฑ ูโุชูุงูุฏ ุงูุชุฎุงุจ ฺฉูุฏ
- ุฑุณุฏ ุณุฑุนโุชุฑ ุชููุฏ ูโุดูุฏ

---

## ูุชุฌูโฺฏุฑ

**ุจูุชุฑู ุฑุงูโุญู:** 
1. ุญุฐู `receipt_service.py`
2. ุงุณุชูุงุฏู ุงุฒ `pdf_service.py` ุจุฑุง ููู ููุงุฑุฏ
3. ุงุฑุงุฆู ุฏู ฺฏุฒูู ุจู ฺฉุงุฑุจุฑ:
   - ุฏฺฉูู "ุฏุงูููุฏ ุฑุณุฏ" โ `/receipt/` โ `generate_receipt()`
   - ุฏฺฉูู "ุฏุงูููุฏ ูุงฺฉุชูุฑ" โ `/invoice/` โ `generate_invoice()`

ุงู ุฑุงูโุญู ูู ุงูุนุทุงูโูพุฐุฑ ุงุณุช ู ูู ฺฉูพุงุฑฺู.
